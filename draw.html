<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ æ•™å®¤æŠ½çç³»çµ± ğŸ</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    background: url('cover.jpg') center/cover no-repeat fixed;
    text-align: center;
    color: white;
    margin: 0;
    min-height: 100vh;
    backdrop-filter: blur(3px);
  }
  h1 {
    font-size: 36px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.6);
    margin-top: 40px;
  }
  input {
    padding: 10px;
    margin: 10px;
    border-radius: 8px;
    border: none;
    width: 120px;
    font-size: 18px;
    text-align: center;
  }
  button {
    padding: 10px 20px;
    font-size: 20px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 10px;
    margin: 10px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background-color: #218838;
  }
  #result {
    font-size: 22px;
    margin-top: 30px;
    text-shadow: 1px 1px 6px rgba(0,0,0,0.6);
  }
  #prizeImage {
    margin-top: 20px;
    max-width: 400px;
    max-height: 400px;
    border-radius: 20px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
</style>
</head>

<body>
  <h1>ğŸ æ•™å®¤æŠ½çç³»çµ± ğŸ</h1>

  <input type="text" id="className" placeholder="ç­ç´š(ä¾‹:506)">
  <input type="text" id="seatNumber" placeholder="åº§è™Ÿ(ä¾‹:12)">
  <br>
  <button onclick="startDraw()">é–‹å§‹æŠ½ç</button>
  <button onclick="goHome()">å›é¦–é </button>

  <div id="result"></div>
  <img id="prizeImage" src="" alt="çé …åœ–ç‰‡" hidden>

<script>
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdY6-MpgXPSRBovznmZb-phQwWloZ_tf51KiPLo7Qc1cPgpq/formResponse";

// ğŸ æ‰€æœ‰çé …èˆ‡æ©Ÿç‡è¨­å®š
const prizes = [
  { name: "å·¨å¤§æ©¡çš®æ“¦ä¸€é¡†", weight: 0.10, img: "eraser.jpg" },
  { name: "è‡ªå‹•é‰›ç­†ä¸€æ", weight: 0.12, img: "pencil.jpg" },
  { name: "è±†è±†è²¼ä¸€å€‹", weight: 0.10, img: "sticker.jpg" },
  { name: "ä¾¿åˆ©è²¼ä¸€å€‹", weight: 0.10, img: "note.jpg" },
  { name: "å¤šè‚‰æ¤ç‰©ä¸€ç›†", weight: 0.08, img: "succulent.jpg" },
  { name: "ç´‹èº«è²¼ç´™ä¸€å¼µ", weight: 0.10, img: "tattoo.jpg" },
  { name: "é‰›ç­†ç›’ä¸€å€‹", weight: 0.07, img: "case.jpg" },
  { name: "é¹¿è§’è•¨ä¸€æ ª", weight: 0.03, img: "fern.jpg" },
  { name: "èŠ±ç›†ä¸€å€‹", weight: 0.08, img: "pot.jpg" },
  { name: "è¿·è¿­é¦™ç›†æ ½ä¸€å€‹", weight: 0.07, img: "rosemary.jpg" },
  { name: "æææ¨‚ä¸€å€‹", weight: 0.05, img: "squishy.jpg" },
  { name: "å¨ƒå¨ƒä¸€å€‹", weight: 0.07, img: "doll.jpg" },
  { name: "è¬è¬æƒ é¡§", weight: 0.08, img: "sorry.jpg" }
];

// âœ… æŠ½çä¸»ç¨‹å¼
function startDraw() {
  const className = document.getElementById("className").value.trim();
  const seatNumber = document.getElementById("seatNumber").value.trim();
  if (!className || !seatNumber) {
    alert("è«‹è¼¸å…¥ç­ç´šèˆ‡åº§è™Ÿï¼");
    return;
  }

  const prize = getRandomPrize();
  const resultText = `ğŸ‰ æ­å–œ ${className} ç­ ${seatNumber} è™Ÿ æŠ½ä¸­ï¼š${prize.name}`;
  document.getElementById("result").innerText = resultText;

  // é¡¯ç¤ºåœ–ç‰‡
  const img = document.getElementById("prizeImage");
  img.src = prize.img;
  img.hidden = false;

  // å‚³é€è‡³ Google è¡¨å–®
  submitToGoogleForm(className, seatNumber, prize.name);
}

// âœ… åŠ æ¬Šéš¨æ©ŸæŠ½ç
function getRandomPrize() {
  const total = prizes.reduce((sum, p) => sum + p.weight, 0);
  let random = Math.random() * total;
  for (const p of prizes) {
    random -= p.weight;
    if (random <= 0) return p;
  }
  return prizes[prizes.length - 1];
}

// âœ… å‚³é€åˆ° Google è¡¨å–®ï¼ˆä½ æä¾›çš„ entry IDï¼‰
function submitToGoogleForm(className, seat, prize) {
  const timestamp = new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });
  const formData = new FormData();
  formData.append("entry.945593983", className);
  formData.append("entry.39955326", seat);
  formData.append("entry.1927388385", prize);
  formData.append("entry.1093494949", timestamp);

  fetch(FORM_URL, {
    method: "POST",
    body: formData,
    mode: "no-cors" // âœ… è®“å­¸æ ¡ç¶²è·¯ä¸æœƒæ“‹
  }).then(() => {
    console.log("âœ… å·²é€å‡ºé›²ç«¯ç´€éŒ„");
    showSyncSuccess();
  }).catch(err => console.error("âŒ éŒ¯èª¤ï¼š", err));
}

// âœ… é¡¯ç¤ºã€Œå·²åŒæ­¥ã€æç¤º
function showSyncSuccess() {
  const msg = document.createElement("div");
  msg.textContent = "âœ… å·²åŒæ­¥åˆ°é›²ç«¯";
  msg.style.position = "fixed";
  msg.style.bottom = "30px";
  msg.style.left = "50%";
  msg.style.transform = "translateX(-50%)";
  msg.style.backgroundColor = "rgba(40,167,69,0.9)";
  msg.style.color = "white";
  msg.style.padding = "10px 20px";
  msg.style.borderRadius = "10px";
  msg.style.fontSize = "18px";
  msg.style.zIndex = "9999";
  document.body.appendChild(msg);
  setTimeout(() => msg.remove(), 2000);
}

function goHome() {
  window.location.href = "index.html";
}
</script>
</body>
</html>

