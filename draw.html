<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎁 教室抽獎系統 🎁</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    background: url('cover.jpg') center/cover no-repeat fixed;
    text-align: center;
    color: white;
    margin: 0;
    min-height: 100vh;
    backdrop-filter: blur(3px);
  }
  h1 {
    font-size: 36px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.6);
    margin-top: 40px;
  }
  input {
    padding: 10px;
    margin: 10px;
    border-radius: 8px;
    border: none;
    width: 120px;
    font-size: 18px;
    text-align: center;
  }
  button {
    padding: 10px 20px;
    font-size: 20px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 10px;
    margin: 10px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background-color: #218838;
  }
  #result {
    font-size: 22px;
    margin-top: 30px;
    text-shadow: 1px 1px 6px rgba(0,0,0,0.6);
  }
  #prizeImage {
    margin-top: 20px;
    max-width: 400px;
    max-height: 400px;
    border-radius: 20px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
</style>
</head>

<body>
  <h1>🎁 教室抽獎系統 🎁</h1>

  <input type="text" id="className" placeholder="班級(例:506)">
  <input type="text" id="seatNumber" placeholder="座號(例:12)">
  <br>
  <button onclick="startDraw()">開始抽獎</button>
  <button onclick="goHome()">回首頁</button>

  <div id="result"></div>
  <img id="prizeImage" src="" alt="獎項圖片" hidden>

<script>
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdY6-MpgXPSRBovznmZb-phQwWloZ_tf51KiPLo7Qc1cPgpq/formResponse";

// 🎁 所有獎項與機率設定
const prizes = [
  { name: "巨大橡皮擦一顆", weight: 0.10, img: "eraser.jpg" },
  { name: "自動鉛筆一枝", weight: 0.12, img: "pencil.jpg" },
  { name: "豆豆貼一個", weight: 0.10, img: "sticker.jpg" },
  { name: "便利貼一個", weight: 0.10, img: "note.jpg" },
  { name: "多肉植物一盆", weight: 0.08, img: "succulent.jpg" },
  { name: "紋身貼紙一張", weight: 0.10, img: "tattoo.jpg" },
  { name: "鉛筆盒一個", weight: 0.07, img: "case.jpg" },
  { name: "鹿角蕨一株", weight: 0.03, img: "fern.jpg" },
  { name: "花盆一個", weight: 0.08, img: "pot.jpg" },
  { name: "迷迭香盆栽一個", weight: 0.07, img: "rosemary.jpg" },
  { name: "捏捏樂一個", weight: 0.05, img: "squishy.jpg" },
  { name: "娃娃一個", weight: 0.07, img: "doll.jpg" },
  { name: "謝謝惠顧", weight: 0.08, img: "sorry.jpg" }
];

// ✅ 抽獎主程式
function startDraw() {
  const className = document.getElementById("className").value.trim();
  const seatNumber = document.getElementById("seatNumber").value.trim();
  if (!className || !seatNumber) {
    alert("請輸入班級與座號！");
    return;
  }

  const prize = getRandomPrize();
  const resultText = `🎉 恭喜 ${className} 班 ${seatNumber} 號 抽中：${prize.name}`;
  document.getElementById("result").innerText = resultText;

  // 顯示圖片
  const img = document.getElementById("prizeImage");
  img.src = prize.img;
  img.hidden = false;

  // 傳送至 Google 表單
  submitToGoogleForm(className, seatNumber, prize.name);
}

// ✅ 加權隨機抽獎
function getRandomPrize() {
  const total = prizes.reduce((sum, p) => sum + p.weight, 0);
  let random = Math.random() * total;
  for (const p of prizes) {
    random -= p.weight;
    if (random <= 0) return p;
  }
  return prizes[prizes.length - 1];
}

// ✅ 傳送到 Google 表單（你提供的 entry ID）
function submitToGoogleForm(className, seat, prize) {
  const timestamp = new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });
  const formData = new FormData();
  formData.append("entry.945593983", className);
  formData.append("entry.39955326", seat);
  formData.append("entry.1927388385", prize);
  formData.append("entry.1093494949", timestamp);

  fetch(FORM_URL, {
    method: "POST",
    body: formData,
    mode: "no-cors" // ✅ 讓學校網路不會擋
  }).then(() => {
    console.log("✅ 已送出雲端紀錄");
    showSyncSuccess();
  }).catch(err => console.error("❌ 錯誤：", err));
}

// ✅ 顯示「已同步」提示
function showSyncSuccess() {
  const msg = document.createElement("div");
  msg.textContent = "✅ 已同步到雲端";
  msg.style.position = "fixed";
  msg.style.bottom = "30px";
  msg.style.left = "50%";
  msg.style.transform = "translateX(-50%)";
  msg.style.backgroundColor = "rgba(40,167,69,0.9)";
  msg.style.color = "white";
  msg.style.padding = "10px 20px";
  msg.style.borderRadius = "10px";
  msg.style.fontSize = "18px";
  msg.style.zIndex = "9999";
  document.body.appendChild(msg);
  setTimeout(() => msg.remove(), 2000);
}

function goHome() {
  window.location.href = "index.html";
}
</script>
</body>
</html>

